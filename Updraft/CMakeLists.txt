PROJECT(updraft)
FIND_PACKAGE(Qt4 REQUIRED)

cmake_minimum_required(VERSION 2.8)

SET(QT_USE_QTOPENGL TRUE)

ADD_DEFINITIONS(${QT_DEFINITIONS})

FILE(GLOB_RECURSE CORE_SOURCES ${CMAKE_CURRENT_SOURCE_DIR}/src/core/*.cpp)
FILE(GLOB_RECURSE CORE_HEADERS ${CMAKE_CURRENT_SOURCE_DIR}/src/core/*.h)
FILE(GLOB         PLUGINAPI_HEADERS ${CMAKE_CURRENT_SOURCE_DIR}/src/*.h)
FILE(GLOB_RECURSE CORE_FORMS
	${CMAKE_CURRENT_SOURCE_DIR}/src/core/*.ui)
FILE(GLOB_RECURSE CORE_RESOURCES
	${CMAKE_CURRENT_SOURCE_DIR}/src/core/*.qrc)

SET(LANG
	translations/czech.ts
)

FILE(GLOB PLUGIN_DIRS ${CMAKE_CURRENT_SOURCE_DIR}/src/plugins/*)
FILE(GLOB STATIC_PLUGIN_DIRS ${CMAKE_CURRENT_SOURCE_DIR}/src/staticplugins/*)

ADD_DEFINITIONS(-DQT_PLUGIN)
ADD_DEFINITIONS(-DQT_NO_DEBUG)
ADD_DEFINITIONS(-DQT_SHARED)

message("Static plugins:")
foreach(PLUGIN_DIR ${STATIC_PLUGIN_DIRS})
	get_filename_component(PLUGIN_NAME ${PLUGIN_DIR} NAME)
	message(${PLUGIN_NAME})

	FILE(GLOB_RECURSE PLUGIN_SOURCES ${PLUGIN_DIR}/*.cpp)
	FILE(GLOB_RECURSE PLUGIN_HEADERS ${PLUGIN_DIR}/*.cpp)

	QT4_WRAP_CPP(PLUGIN_HEADERS_MOC ${PLUGIN_HEADERS} ${PLUGIN_SOURCES})

	ADD_LIBRARY(testPlugin STATIC
		${PLUGIN_SOURCES}
		${PLUGIN_SOURCES_MOC}
	)
LIST(APPEND STATIC_PLUGINS ${PLUGIN_NAME})
endforeach(PLUGIN_DIR)

message("Dynamic plugins:")
foreach(PLUGIN_DIR ${PLUGIN_DIRS})
	get_filename_component(PLUGIN_NAME ${PLUGIN_DIR} NAME)
	message(${PLUGIN_NAME})
endforeach(PLUGIN_DIR)

REMOVE_DEFINITIONS(-DQT_PLUGIN)
REMOVE_DEFINITIONS(-DQT_NO_DEBUG)
REMOVE_DEFINITIONS(-DQT_SHARED)

PROJECT(updraft)
QT4_WRAP_CPP(CORE_HEADERS_MOC ${CORE_HEADERS})
QT4_WRAP_UI(CORE_FORMS_HEADERS ${CORE_FORMS})
QT4_ADD_RESOURCES(CORE_RESOURCES_RCC ${CORE_RESOURCES})
QT4_ADD_TRANSLATION(TRANSLATIONS ${LANG})

INCLUDE(${QT_USE_FILE})
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR})
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/src/)
ADD_DEFINITIONS(${QT_DEFINITIONS})

ADD_CUSTOM_TARGET(style-check ALL python
	${CMAKE_SOURCE_DIR}/scripts/cpplint.py ${CORE_SOURCES} ${CORE_HEADERS})

ADD_EXECUTABLE(
	updraft
	${CORE_SOURCES} 
	${CORE_HEADERS_MOC} 
	${CORE_FORMS_HEADERS}
	${CORE_RESOURCES_RCC}
	${TRANSLATIONS}
)

TARGET_LINK_LIBRARIES(updraft ${QT_LIBRARIES} ${STATIC_PLUGINS})

